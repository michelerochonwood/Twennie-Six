{{#*inline "title"}}Membership Form | Twennie{{/inline}}

<form id="member-form" action="/member/form" method="POST" class="membership-form">
  <input type="hidden" name="_csrf" value="{{csrfToken}}">
  <input type="hidden" name="redirectTarget" id="redirectTarget" value="form">

  <div style="text-align: center; margin-bottom: 1.5rem;">
    <img src="/images/bluey1.png" alt="Ind Membership" style="max-height: 180px; margin-top: 30px; margin-bottom: -30px">
  </div>

  <div class="individual-form-container">
    <h1 class="form-title">individual membership form</h1>

    <!-- Redirect Note for Paid Members -->
    <div id="paid-redirect-note" class="form-field hidden">
      <p>You will be redirected to the payment page to complete your membership.</p>
    </div>

    <!-- Fields with prefilled values -->
    <div class="form-field">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" value="{{user.name}}" required>
    </div>

    <div class="form-field">
      <label for="professionalTitle">Professional Title</label>
      <input type="text" id="professionalTitle" name="professionalTitle" value="{{user.professionalTitle}}" required>
    </div>

    <div class="form-field">
      <label for="organization">Organization (optional)</label>
      <input type="text" id="organization" name="organization" value="{{user.organization}}">
    </div>

    <div class="form-field-industry">
      <label for="industry">Industry</label>
      <select id="industry" name="industry" required>
        <option value="">Please select an industry</option>
        {{#each [
          "Engineering","Architecture","Project Management","Information Technology(IT)","Web Design","Construction",
          "Social Media/Digital Advertising","Community Planning/Landscape Architecture","Land Development",
          "E-Commerce","Cybersecurity","Fintech","Edtech","Energy and Utilities","Manufacturing","Other"
        ]}}
          <option value="{{this}}" {{#ifEquals this ../user.industry}}selected{{/ifEquals}}>{{this}}</option>
        {{/each}}
      </select>
    </div>

    <div class="form-field">
      <label for="username">Username (how you prefer to be addressed on twennie.com)</label>
      <input type="text" name="username" id="username" value="{{user.username}}" required>
      <span id="username-message"></span>
    </div>

    <div class="form-field">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" value="{{user.email}}" required>
    </div>

    <div class="form-field password-toggle-container">
      <label for="password">Password</label>
      <div class="password-wrapper">
        <input type="password" id="password" name="password" required>
        <span class="toggle-password" onclick="togglePasswordVisibility()">
          <ion-icon id="toggleIcon" name="eye-outline"></ion-icon>
        </span>
      </div>
    </div>

    <!-- Submit -->
    <button type="submit" id="make-member-button" class="make-member-button">
      make me a member
    </button>
  </div>
</form>

<script>
function handleAccessLevelChange(value) {
  const contributorTerms = document.getElementById('contributor-terms');
  const contributorAgreement = document.getElementById('contributorAgreement');
  const paidNote = document.getElementById('paid-redirect-note');
  const redirectTarget = document.getElementById('redirectTarget');

  contributorTerms?.classList.add('hidden');
  paidNote?.classList.add('hidden');
  contributorAgreement?.removeAttribute('required');
  redirectTarget.value = 'form';

  if (value === 'contributor_individual') {
    contributorTerms?.classList.remove('hidden');
    contributorAgreement?.setAttribute('required', 'required');
  } else if (value === 'paid_individual') {
    paidNote?.classList.remove('hidden');
    redirectTarget.value = 'payment';
  }
}

function togglePasswordVisibility() {
  const input = document.getElementById("password");
  const icon = document.getElementById("toggleIcon");
  if (input.type === "password") {
    input.type = "text";
    icon.name = "eye-off-outline";
  } else {
    input.type = "password";
    icon.name = "eye-outline";
  }
}

document.querySelector('#username').addEventListener('blur', async function () {
  const username = this.value;
  const res = await fetch(`/check-username?username=${encodeURIComponent(username)}`);
  const data = await res.json();
  const msg = document.querySelector('#username-message');
  if (!data.available) {
    msg.textContent = 'That username is already taken. Try something unique like Brian-Warrior1.';
    msg.style.color = 'red';
  } else {
    msg.textContent = 'Username is available!';
    msg.style.color = 'green';
  }
});
</script>

<style>
.hidden {
  display: none;
}
</style>
