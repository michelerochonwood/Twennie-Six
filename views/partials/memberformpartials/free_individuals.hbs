{{#*inline "title"}}Free Membership Form | Twennie{{/inline}}

<form id="member-form" action="/member/form" method="POST" class="membership-form">
  <input type="hidden" name="_csrf" value="{{csrfToken}}">
  <input type="hidden" name="accessLevel" value="free_individual">
  <input type="hidden" name="redirectTarget" value="form">

  <div class="individual-form-container">
    <!-- Centered Image -->
    <div style="text-align: center; margin-bottom: 1.5rem;">
      <img src="/images/freebluey.png" alt="Free Membership" style="max-height: 200px;">
    </div>

    <h1 class="form-title">free membership form</h1>

    <!-- Access Level Select -->
    <div class="form-field-access-level">
      <label for="accessLevel">Choose your membership type</label>
      <select id="accessLevel" name="accessLevel" required onchange="handleAccessLevelChange(this.value)">
        <option value="">Please select an access level</option>
        <option value="free_individual" selected>Free Member</option>
        <option value="contributor_individual">Contributor Member</option>
      </select>
    </div>

    <!-- Contributor Terms -->
    <div id="contributor-terms" class="form-field hidden">
      <p><strong>Contributor Agreement</strong></p>
      <ul>
        <li>To maintain a contributor membership, members must submit one library unit per month. All submitted units are subject to the approval of Twennie administrators.</li>
        <li>Instructions for submitting units are available in each submission form.</li>
        <li>If you need further information about submitting library units or the contributor membership option, contact Twennie at <a href="mailto:info@twennie.com">info@twennie.com</a>.</li>
      </ul>
      <div class="checkbox-wrapper">
        <input type="checkbox" id="contributorAgreement" name="contributorAgreement" required>
        <label for="contributorAgreement">I have read and understand these conditions.</label>
      </div>
    </div>

    <!-- Pre-filled Fields -->
    <div class="form-field">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" value="{{user.name}}" required>
    </div>

    <div class="form-field">
      <label for="professionalTitle">Professional Title</label>
      <input type="text" id="professionalTitle" name="professionalTitle" value="{{user.professionalTitle}}" required>
    </div>

    <div class="form-field">
      <label for="organization">Organization (optional)</label>
      <input type="text" id="organization" name="organization" value="{{user.organization}}">
    </div>

    <div class="form-field-industry">
      <label for="industry">Industry</label>
      <select id="industry" name="industry" required>
        <option value="">Please select an industry</option>
        {{#each [
          "Engineering","Architecture","Project Management","Information Technology(IT)","Web Design","Construction",
          "Social Media/Digital Advertising","Community Planning/Landscape Architecture","Land Development",
          "E-Commerce","Cybersecurity","Fintech","Edtech","Energy and Utilities","Manufacturing","Other"
        ]}}
          <option value="{{this}}" {{#ifEquals this ../user.industry}}selected{{/ifEquals}}>{{this}}</option>
        {{/each}}
      </select>
    </div>

    <div class="form-field">
      <label for="username">Username</label>
      <input type="text" name="username" id="username" value="{{user.username}}" required>
      <span id="username-message"></span>
    </div>

    <div class="form-field">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" value="{{user.email}}" required>
    </div>

    <div class="form-field password-toggle-container">
      <label for="password">Password</label>
      <div class="password-wrapper">
        <input type="password" id="password" name="password" required>
        <span class="toggle-password" onclick="togglePasswordVisibility()">
          <ion-icon id="toggleIcon" name="eye-outline"></ion-icon>
        </span>
      </div>
    </div>

    <!-- Submit -->
    <button type="submit" id="make-member-button" class="make-member-button">
      make me a free member
    </button>
  </div>
</form>

<script>
  function togglePasswordVisibility() {
    const input = document.getElementById("password");
    const icon = document.getElementById("toggleIcon");
    if (input.type === "password") {
      input.type = "text";
      icon.name = "eye-off-outline";
    } else {
      input.type = "password";
      icon.name = "eye-outline";
    }
  }

  function handleAccessLevelChange(value) {
    const contributorTerms = document.getElementById("contributor-terms");
    const contributorCheckbox = document.getElementById("contributorAgreement");

    if (value === "contributor_individual") {
      contributorTerms.classList.remove("hidden");
      contributorCheckbox.setAttribute("required", "required");
    } else {
      contributorTerms.classList.add("hidden");
      contributorCheckbox.removeAttribute("required");
    }
  }

  document.querySelector('#username').addEventListener('blur', async function () {
    const username = this.value;
    const res = await fetch(`/check-username?username=${encodeURIComponent(username)}`);
    const data = await res.json();
    const msg = document.querySelector('#username-message');
    if (!data.available) {
      msg.textContent = 'That username is already taken. Try something unique like Brian-Warrior1.';
      msg.style.color = 'red';
    } else {
      msg.textContent = 'Username is available!';
      msg.style.color = 'green';
    }
  });
</script>

<style>
  .hidden {
    display: none;
  }
</style>
