<div class="single_exercise-container">
  <!-- Main Section -->
  <div class="single_exercise-main">

    <h1 class="single_exercise-main-title">{{exercise_title}}</h1>
    <p class="single_exercise-short-summary" style="color:#4e50a2;"><strong>{{short_summary}}</strong></p>
    <p class="single_exercise-long-summary" style="margin-bottom: 20px;">{{full_summary}}</p>

    <!-- Estimated Time Display -->
{{#if time_required}}
  <div class="single_exercise-time-display">
    <p class="single_exercise-short-summary"><strong>Estimated Time:</strong> {{time_required}}</p>
  </div>
{{/if}}

<!-- Uploaded Documents Display -->





    <!-- Download Button -->
{{#if isAuthorizedToViewFullContent}}
  <!-- Download Button -->
  <div class="single_exercise-download">
    <div class="single_exercise-download-icon">
       <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 164.27 150.53">
  <defs>
    <style>
      .cls-1 {
        fill: #4e50a2;
      }

      .cls-2 {
        fill: #fff;
      }

      .cls-3 {
        fill: #d1d3d4;
      }

      .cls-4 {
        fill: #bcbec0;
      }
    </style>
  </defs>
  <g id="Layer_1-2" data-name="Layer 1">
    <polygon class="cls-3" points="0 24.15 0 150.53 103.78 150.53 103.78 48.29 79.12 24.15 0 24.15"/>
    <rect class="cls-4" x="12.95" y="83.64" width="76.44" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="12.95" y="100.34" width="76.44" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="12.95" y="117.03" width="76.44" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="12.95" y="133.73" width="76.44" height="5.2" rx="1.95" ry="1.95"/>
    <polygon class="cls-2" points="28.88 0 28.88 126.38 132.65 126.38 132.65 24.15 107.99 0 28.88 0"/>
    <rect class="cls-1" x="42.17" y="27.21" width="24.66" height="24.66"/>
    <path class="cls-2" d="M51.99,38.45s-2.63-3.21-5.14-.83c-2.22,2.11.51,4.69.51,4.69l3.66,3.47s2.12,1.54,3.28,0,8.48-8.69,8.48-8.69c0,0,.96-3.06-.96-4.02-1.93-.96-3.47,0-3.47,0l-6.36,5.39Z"/>
    <rect class="cls-4" x="75.88" y="27.21" width="42.38" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="75.88" y="41.26" width="42.38" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="41.82" y="59.49" width="76.44" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="41.82" y="76.19" width="44.62" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="41.82" y="92.89" width="44.62" height="5.2" rx="1.95" ry="1.95"/>
    <rect class="cls-4" x="41.82" y="109.58" width="44.62" height="5.2" rx="1.95" ry="1.95"/>
    <polyline class="cls-4" points="107.99 0 107.99 24.15 132.65 24.15"/>
    <g>
      <polygon class="cls-1" points="159.36 100.99 159.36 112.29 99.81 112.29 99.81 100.99 94.91 100.99 94.91 117.44 99.81 117.44 159.36 117.44 161.91 117.44 164.27 117.44 164.27 100.99 159.36 100.99"/>
      <polygon class="cls-1" points="129.36 107.32 144.67 93.22 131.75 93.22 131.75 60.24 126.97 60.24 126.97 93.22 114.58 93.22 129.36 107.32"/>
    </g>
  </g>
</svg>
        </div>
{{#if isAuthorizedToViewFullContent}}
  {{#if document_uploads}}
    <div class="single_exercise-documents">


{{#each document_uploads}}
  {{!-- Extract just the file name from the full URL --}}
  {{#with (split this "/") as |parts|}}
    <a href="{{../this}}" target="_blank" rel="noopener" class="single_exercise-download-btn" download>
      Download {{last parts}}
    </a>
  {{/with}}
{{/each}}
    </div>
  {{/if}}
{{/if}}

    </div>


{{#if isLeader}}
<div class="assign-tag-form white-container">
  <h4 class="assign-tag-title">Assign this exercise to group members</h4>
  <form id="assignTagForm" onsubmit="submitAssignedTag(event)">
    <input type="hidden" name="_csrf" value="{{csrfToken}}">
    <input type="hidden" id="unitId" value="{{_id}}">
    <input type="hidden" id="unitType" value="exercise">

    <div class="form-field">
      <label for="tagName">Give the tag a name</label>
      <input type="text" id="tagName" name="tagName" required>
    </div>

    <fieldset class="assign-tag-members">
      <legend class="assign-tag-legend">Select group members and enter instructions:</legend>
      {{#each groupMembers}}
        <div class="assign-tag-member-block">
          <label class="assign-tag-member-label">
            <input 
              type="checkbox" 
              name="assignedTo" 
              value="{{_id}}" 
              data-name="{{name}}" 
              onchange="toggleInstructionField(this)">
            {{name}}
          </label>
          <textarea 
            class="assign-tag-instructions" 
            name="instructions-{{_id}}" 
            placeholder="Instructions for {{name}}" 
            style="display: none;"></textarea>
        </div>
      {{/each}}
    </fieldset>

    <button type="submit" class="form-button submit-button">assign tag</button>
  </form>
</div>
{{/if}}

{{#if isGroupMemberOrMember}}
  <div class="single_unit-tag-container">
    <form id="tagForm" onsubmit="tagUnit(event)">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <input type="hidden" id="unitId" value="{{_id}}">
      <input type="hidden" id="unitType" value="exercise">
      <a href="#" onclick="tagUnit(event)" class="tag-this-unit-link">
        tag this unit
        <svg class="tag-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39.48 36.66">
          <path class="cls-1" d="M38.77,21.12L16.05.56C15.65.19,15.13,0,14.59,0L2.12.16c-1.18.01-2.12.97-2.12,2.15v11.2c0,.63.28,1.24.77,1.64l24.95,21c.9.76,2.24.65,3.01-.24l10.23-11.8c.77-.88.69-2.22-.18-3ZM6.28,8.87c-1.57,0-2.84-1.27-2.84-2.84s1.27-2.84,2.84-2.84,2.84,1.27,2.84,2.84-1.27,2.84-2.84,2.84Z"/>
        </svg>
      </a>
    </form>
  </div>
  {{/if}}

  <!-- Notes Form -->
  {{#if isGroupMemberOrLeader}}
    <div class="single_exercise-notes-container">
      <h3 class="single_exercise-notes-title">record notes</h3>
      <p class="single_exercise-notes-instructions">
        Record notes on this exercise. Consider how it relates to your work and how it might change your approach. These notes will be part of your Twennie learning record.
      </p>

      <form action="/notes/submit" method="POST" class="single_exercise-notes-form">
        <input type="hidden" name="_csrf" value="{{csrfToken}}">
        <input type="hidden" name="unitId" value="{{_id}}">
        <input type="hidden" name="unitType" value="{{unitType}}">
        <input type="hidden" name="main_topic" value="{{main_topic}}">
        <input type="hidden" name="secondary_topic" value="{{sub_topic}}">

        <textarea name="note_content" class="single_exercise-notes-textarea" rows="5" maxlength="1000" 
                  placeholder="Write your notes here..."></textarea>

        <button type="submit" class="single_exercise-notes-submit">submit notes</button>
      </form>
    </div>
  {{/if}}
{{else}}
  <div class="exercise-access-denied-message">
    <p style="text-align: center; color: #4e50a2; font-weight: 600;">
      You do not have access to the full content of this exercise.
    </p>
    <p style="text-align: center;">
      Please upgrade your membership or join a Twennie group to view it.
    </p>
  </div>
{{/if}}
  </div> <!-- Closing .single_exercise-main -->

  <!-- Sidebar -->
  <aside class="single_exercise-sidebar">
    <div class="single_exercise-duration-image-container" style="text-align: center; margin-bottom: 10px; width: 100px; height: auto; display: inline-block">
  <img src="https://www.twennie.com/images/30mins.svg" alt="Estimated Time: 30 Minutes" class="single_exercise-duration-image">
</div>
    <p class="single_exercise-title-sidebar">{{exercise_title}}</p>

    <div class="single_exercise-author">
      <img src="{{creator.image}}" alt="Creator Image" class="single_exercise-author-image">
      <p class="single_exercise-author-name">Created by: {{creator.name}}</p>
    </div>

    <div class="single_exercise-details">
      <p class="single_exercise-unit-type">Exercise</p>
      <p class="single_exercise-main-topic">Main Topic: {{main_topic}}</p>
      <p class="single_exercise-subtitle">Sub Topic(s): {{sub_topic}}</p>
      <p class="single_exercise-secondary-topics">{{#each secondary_topics}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</p>

      {{#if isOwner}}
        <a href="/unitform/edit_exercise/{{_id}}" class="single_exercise-edit-btn">edit this unit</a>
      {{/if}}
    </div>
  </aside>
</div> <!-- Closing .single_exercise-container -->


